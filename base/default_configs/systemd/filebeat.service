[Unit]
Description=Filebeat Log Collector
Wants=network-online.target
After=network-online.target
PartOf=dynamite-agent.target

[Service]
User=dynamite
Group=dynamite
EnvironmentFile=/etc/dynamite/environment
Environment=PIDFILE=/var/run/dynamite/filebeat.pid
PIDFile=/var/run/dynamite/filebeat.pid
ExecStartPre=/bin/mkdir -p /var/run/dynamite/
ExecStart=/bin/bash -c "${FILEBEAT_HOME}/filebeat -c ${FILEBEAT_HOME}/filebeat.yml --strict.perms=false"
ExecStartPost=/bin/bash -c "umask 022; pgrep filebeat > ${PIDFILE}"
Restart=always
RestartSec=10s
StandardOutput=syslog
StandardError=syslog

[Install]
WantedBy=dynamite-agent.target